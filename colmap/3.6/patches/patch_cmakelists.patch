diff --git a/CMakeLists.txt b/CMakeLists.txt
index b05097c..33ce477 100755
--- a/CMakeLists.txt
+++ b/CMakeLists.txt
@@ -41,7 +41,9 @@ set(COLMAP_VERSION_NUMBER "3600")
 # Include CMake dependencies
 ################################################################################
 
-set(CMAKE_MODULE_PATH ${CMAKE_CURRENT_SOURCE_DIR}/cmake)
+#set(CMAKE_MODULE_PATH ${CMAKE_CURRENT_SOURCE_DIR}/cmake)
+set(CMAKE_MODULE_PATH ${CMAKE_MODULE_PATH} ${CMAKE_CURRENT_SOURCE_DIR})
+add_definitions(/bigobj)
 
 include(CheckCXXCompilerFlag)
 
@@ -103,6 +105,7 @@ find_package(Glog REQUIRED)
 find_package(OpenGL REQUIRED)
 find_package(Glew REQUIRED)
 find_package(Git)
+find_package(Flann)
 
 if(CGAL_ENABLED)
     set(CGAL_DO_NOT_WARN_ABOUT_CMAKE_BUILD_TYPE TRUE)
@@ -276,18 +279,20 @@ set(COLMAP_LINK_DIRS
 
 set(COLMAP_EXTERNAL_LIBRARIES
     ${CMAKE_DL_LIBS}
-    ${Boost_FILESYSTEM_LIBRARY}
-    ${Boost_PROGRAM_OPTIONS_LIBRARY}
-    ${Boost_REGEX_LIBRARY}
-    ${Boost_SYSTEM_LIBRARY}
-    ${GLOG_LIBRARIES}
-    ${FREEIMAGE_LIBRARIES}
-    ${CERES_LIBRARIES}
-    ${OPENGL_gl_LIBRARY}
-    ${OPENGL_glu_LIBRARY}
-    ${Qt5Core_LIBRARIES}
-    ${Qt5OpenGL_LIBRARIES}
-    ${Qt5Widgets_LIBRARIES}
+    # ${Boost_FILESYSTEM_LIBRARY}
+    # ${Boost_PROGRAM_OPTIONS_LIBRARY}
+    # ${Boost_REGEX_LIBRARY}
+    # ${Boost_SYSTEM_LIBRARY}
+    # ${GLOG_LIBRARIES}
+    # ${FREEIMAGE_LIBRARIES}
+    # ${CERES_LIBRARIES}
+    # ${OPENGL_gl_LIBRARY}
+    # ${OPENGL_glu_LIBRARY}
+    # ${Qt5Core_LIBRARIES}
+    # ${Qt5OpenGL_LIBRARIES}
+    # ${Qt5Widgets_LIBRARIES}
+	# ${Flann_LIBRARIES}
+	${CONAN_LIBS}
 )
 
 if(OPENMP_FOUND)
@@ -305,7 +310,7 @@ if(UNIX)
 endif()
 
 set(COLMAP_INTERNAL_LIBRARIES
-    flann
+    #flann
     graclus
     lsd
     pba
@@ -331,7 +336,7 @@ add_subdirectory(src)
 # Generate source groups for Visual Studio, XCode, etc.
 ################################################################################
 
-COLMAP_ADD_SOURCE_DIR(lib/FLANN LIB_FLANN_SRCS *.h *.cpp *.hpp *.cu)
+#COLMAP_ADD_SOURCE_DIR(lib/FLANN LIB_FLANN_SRCS *.h *.cpp *.hpp *.cu)
 COLMAP_ADD_SOURCE_DIR(lib/Graclus LIB_GRACLUS_SRCS *.h *.c)
 COLMAP_ADD_SOURCE_DIR(lib/LSD LIB_LSD_SRCS *.h *.c)
 COLMAP_ADD_SOURCE_DIR(lib/PBA LIB_PBA_SRCS *.h *.cpp *.cu)
@@ -358,7 +363,7 @@ COLMAP_ADD_SOURCE_DIR(src/util UTIL_SRCS *.h *.cc)
 # intellisense can't find any of the included files).
 add_library(
     ${COLMAP_SRC_ROOT_FOLDER}
-    ${LIB_FLANN_SRCS}
+    #${LIB_FLANN_SRCS}
     ${LIB_GRACLUS_SRCS}
     ${LIB_LSD_SRCS}
     ${LIB_PBA_SRCS}
